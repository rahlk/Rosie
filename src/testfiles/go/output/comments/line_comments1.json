{"go.line_comments":{"text":"\/\/ Copyright 2014 Manu Martinez-Almeida.  All rights reserved.\n\/\/ Use of this source code is governed by a MIT style\n\/\/ license that can be found in the LICENSE file.\n\npackage gin\n\nimport (\n\t\"fmt\"\n\t\"io\"\n\t\"os\"\n\t\"time\"\n\n\t\"github.com\/mattn\/go-isatty\"\n)\n\nvar (\n\tgreen   = string([]byte{27, 91, 57, 55, 59, 52, 50, 109})\n\twhite   = string([]byte{27, 91, 57, 48, 59, 52, 55, 109})\n\tyellow  = string([]byte{27, 91, 57, 55, 59, 52, 51, 109})\n\tred     = string([]byte{27, 91, 57, 55, 59, 52, 49, 109})\n\tblue    = string([]byte{27, 91, 57, 55, 59, 52, 52, 109})\n\tmagenta = string([]byte{27, 91, 57, 55, 59, 52, 53, 109})\n\tcyan    = string([]byte{27, 91, 57, 55, 59, 52, 54, 109})\n\treset   = string([]byte{27, 91, 48, 109})\n)\n\nfunc ErrorLogger() HandlerFunc {\n\treturn ErrorLoggerT(ErrorTypeAny)\n}\n\nfunc ErrorLoggerT(typ ErrorType) HandlerFunc {\n\treturn func(c *Context) {\n\t\tc.Next()\n\t\terrors := c.Errors.ByType(typ)\n\t\tif len(errors) > 0 {\n\t\t\tc.JSON(-1, errors)\n\t\t}\n\t}\n}\n\n\/\/ Logger instances a Logger middleware that will write the logs to gin.DefaultWriter\n\/\/ By default gin.DefaultWriter = os.Stdout\nfunc Logger() HandlerFunc {\n\treturn LoggerWithWriter(DefaultWriter)\n}\n\n\/\/ LoggerWithWriter instance a Logger middleware with the specified writter buffer.\n\/\/ Example: os.Stdout, a file opened in write mode, a socket...\nfunc LoggerWithWriter(out io.Writer, notlogged ...string) HandlerFunc {\n\tisTerm := true\n\n\tif w, ok := out.(*os.File); !ok || !isatty.IsTerminal(w.Fd()) {\n\t\tisTerm = false\n\t}\n\n\tvar skip map[string]struct{}\n\n\tif length := len(notlogged); length > 0 {\n\t\tskip = make(map[string]struct{}, length)\n\n\t\tfor _, path := range notlogged {\n\t\t\tskip[path] = struct{}{}\n\t\t}\n\t}\n\n\treturn func(c *Context) {\n\t\t\/\/ Start timer\n\t\tstart := time.Now()\n\t\tpath := c.Request.URL.Path\n\n\t\t\/\/ Process request\n\t\tc.Next()\n\n\t\t\/\/ Log only when path is not being skipped\n\t\tif _, ok := skip[path]; !ok {\n\t\t\t\/\/ Stop timer\n\t\t\tend := time.Now()\n\t\t\tlatency := end.Sub(start)\n\n\t\t\tclientIP := c.ClientIP()\n\t\t\tmethod := c.Request.Method\n\t\t\tstatusCode := c.Writer.Status()\n\t\t\tvar statusColor, methodColor string\n\t\t\tif isTerm {\n\t\t\t\tstatusColor = colorForStatus(statusCode)\n\t\t\t\tmethodColor = colorForMethod(method)\n\t\t\t}\n\t\t\tcomment := c.Errors.ByType(ErrorTypePrivate).String()\n\n\t\t\tfmt.Fprintf(out, \"[GIN] %v |%s %3d %s| %13v | %s |%s  %s %-7s %s\\n%s\",\n\t\t\t\tend.Format(\"2006\/01\/02 - 15:04:05\"),\n\t\t\t\tstatusColor, statusCode, reset,\n\t\t\t\tlatency,\n\t\t\t\tclientIP,\n\t\t\t\tmethodColor, reset, method,\n\t\t\t\tpath,\n\t\t\t\tcomment,\n\t\t\t)\n\t\t}\n\t}\n}\n\nfunc colorForStatus(code int) string {\n\tswitch {\n\tcase code >= 200 && code < 300:\n\t\treturn green\n\tcase code >= 300 && code < 400:\n\t\treturn white\n\tcase code >= 400 && code < 500:\n\t\treturn yellow\n\tdefault:\n\t\treturn red\n\t}\n}\n\nfunc colorForMethod(method string) string {\n\tswitch method {\n\tcase \"GET\":\n\t\treturn blue\n\tcase \"POST\":\n\t\treturn cyan\n\tcase \"PUT\":\n\t\treturn yellow\n\tcase \"DELETE\":\n\t\treturn red\n\tcase \"PATCH\":\n\t\treturn green\n\tcase \"HEAD\":\n\t\treturn magenta\n\tcase \"OPTIONS\":\n\t\treturn white\n\tdefault:\n\t\treturn reset\n\t}\n}","pos":1,"subs":[{"go.line_comment":{"text":"\/\/ Copyright 2014 Manu Martinez-Almeida.  All rights reserved.","pos":1,"subs":[{"go.line_comment_context":{"text":"","pos":1}},{"go.line_comment_body":{"text":"\/\/ Copyright 2014 Manu Martinez-Almeida.  All rights reserved.","pos":1,"subs":[{"go.line_comment_text":{"text":" Copyright 2014 Manu Martinez-Almeida.  All rights reserved.","pos":3}}]}}]}},{"go.line_comment":{"text":"\/\/ Use of this source code is governed by a MIT style","pos":64,"subs":[{"go.line_comment_context":{"text":"","pos":64}},{"go.line_comment_body":{"text":"\/\/ Use of this source code is governed by a MIT style","pos":64,"subs":[{"go.line_comment_text":{"text":" Use of this source code is governed by a MIT style","pos":66}}]}}]}},{"go.line_comment":{"text":"\/\/ license that can be found in the LICENSE file.","pos":118,"subs":[{"go.line_comment_context":{"text":"","pos":118}},{"go.line_comment_body":{"text":"\/\/ license that can be found in the LICENSE file.","pos":118,"subs":[{"go.line_comment_text":{"text":" license that can be found in the LICENSE file.","pos":120}}]}}]}},{"go.line_comment":{"text":"\/\/ Logger instances a Logger middleware that will write the logs to gin.DefaultWriter","pos":961,"subs":[{"go.line_comment_context":{"text":"","pos":961}},{"go.line_comment_body":{"text":"\/\/ Logger instances a Logger middleware that will write the logs to gin.DefaultWriter","pos":961,"subs":[{"go.line_comment_text":{"text":" Logger instances a Logger middleware that will write the logs to gin.DefaultWriter","pos":963}}]}}]}},{"go.line_comment":{"text":"\/\/ By default gin.DefaultWriter = os.Stdout","pos":1047,"subs":[{"go.line_comment_context":{"text":"","pos":1047}},{"go.line_comment_body":{"text":"\/\/ By default gin.DefaultWriter = os.Stdout","pos":1047,"subs":[{"go.line_comment_text":{"text":" By default gin.DefaultWriter = os.Stdout","pos":1049}}]}}]}},{"go.line_comment":{"text":"\/\/ LoggerWithWriter instance a Logger middleware with the specified writter buffer.","pos":1162,"subs":[{"go.line_comment_context":{"text":"","pos":1162}},{"go.line_comment_body":{"text":"\/\/ LoggerWithWriter instance a Logger middleware with the specified writter buffer.","pos":1162,"subs":[{"go.line_comment_text":{"text":" LoggerWithWriter instance a Logger middleware with the specified writter buffer.","pos":1164}}]}}]}},{"go.line_comment":{"text":"\/\/ Example: os.Stdout, a file opened in write mode, a socket...","pos":1246,"subs":[{"go.line_comment_context":{"text":"","pos":1246}},{"go.line_comment_body":{"text":"\/\/ Example: os.Stdout, a file opened in write mode, a socket...","pos":1246,"subs":[{"go.line_comment_text":{"text":" Example: os.Stdout, a file opened in write mode, a socket...","pos":1248}}]}}]}},{"go.line_comment":{"text":"\t\t\/\/ Start timer","pos":1700,"subs":[{"go.line_comment_context":{"text":"\t\t","pos":1700}},{"go.line_comment_body":{"text":"\/\/ Start timer","pos":1702,"subs":[{"go.line_comment_text":{"text":" Start timer","pos":1704}}]}}]}},{"go.line_comment":{"text":"\t\t\/\/ Process request","pos":1769,"subs":[{"go.line_comment_context":{"text":"\t\t","pos":1769}},{"go.line_comment_body":{"text":"\/\/ Process request","pos":1771,"subs":[{"go.line_comment_text":{"text":" Process request","pos":1773}}]}}]}},{"go.line_comment":{"text":"\t\t\/\/ Log only when path is not being skipped","pos":1802,"subs":[{"go.line_comment_context":{"text":"\t\t","pos":1802}},{"go.line_comment_body":{"text":"\/\/ Log only when path is not being skipped","pos":1804,"subs":[{"go.line_comment_text":{"text":" Log only when path is not being skipped","pos":1806}}]}}]}},{"go.line_comment":{"text":"\t\t\t\/\/ Stop timer","pos":1879,"subs":[{"go.line_comment_context":{"text":"\t\t\t","pos":1879}},{"go.line_comment_body":{"text":"\/\/ Stop timer","pos":1882,"subs":[{"go.line_comment_text":{"text":" Stop timer","pos":1884}}]}}]}}]}}
