{"cs.strings":{"pos":1,"text":"#region License\n\/\/ Copyright (c) 2007 James Newton-King\n\/\/\n\/\/ Permission is hereby granted, free of charge, to any person\n\/\/ obtaining a copy of this software and associated documentation\n\/\/ files (the \"Software\"), to deal in the Software without\n\/\/ restriction, including without limitation the rights to use,\n\/\/ copy, modify, merge, publish, distribute, sublicense, and\/or sell\n\/\/ copies of the Software, and to permit persons to whom the\n\/\/ Software is furnished to do so, subject to the following\n\/\/ conditions:\n\/\/\n\/\/ The above copyright notice and this permission notice shall be\n\/\/ included in all copies or substantial portions of the Software.\n\/\/\n\/\/ THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\n\/\/ EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n\/\/ OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n\/\/ NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n\/\/ HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n\/\/ WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n\/\/ FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n\/\/ OTHER DEALINGS IN THE SOFTWARE.\n#endregion\n\nusing System;\nusing System.Collections.Generic;\nusing System.Globalization;\nusing System.Text;\nusing Newtonsoft.Json.Utilities;\n\nnamespace Newtonsoft.Json\n{\n    internal enum JsonContainerType\n    {\n        None = 0,\n        Object = 1,\n        Array = 2,\n        Constructor = 3\n    }\n\n    internal struct JsonPosition\n    {\n        private static readonly char[] SpecialCharacters = { '.', ' ', '[', ']', '(', ')' };\n\n        internal JsonContainerType Type;\n        internal int Position;\n        internal string PropertyName;\n        internal bool HasIndex;\n\n        public JsonPosition(JsonContainerType type)\n        {\n            Type = type;\n            HasIndex = TypeHasIndex(type);\n            Position = -1;\n            PropertyName = null;\n        }\n\n        internal int CalculateLength()\n        {\n            switch (Type)\n            {\n                case JsonContainerType.Object:\n                    return PropertyName.Length + 5;\n                case JsonContainerType.Array:\n                case JsonContainerType.Constructor:\n                    return MathUtils.IntLength((ulong)Position) + 2;\n                default:\n                    throw new ArgumentOutOfRangeException(\"Type\");\n            }\n        }\n\n        internal void WriteTo(StringBuilder sb)\n        {\n            switch (Type)\n            {\n                case JsonContainerType.Object:\n                    string propertyName = PropertyName;\n                    if (propertyName.IndexOfAny(SpecialCharacters) != -1)\n                    {\n                        sb.Append(@\"['\");\n                        sb.Append(propertyName);\n                        sb.Append(@\"']\");\n                    }\n                    else\n                    {\n                        if (sb.Length > 0)\n                        {\n                            sb.Append('.');\n                        }\n\n                        sb.Append(propertyName);\n                    }\n                    break;\n                case JsonContainerType.Array:\n                case JsonContainerType.Constructor:\n                    sb.Append('[');\n                    sb.Append(Position);\n                    sb.Append(']');\n                    break;\n            }\n        }\n\n        internal static bool TypeHasIndex(JsonContainerType type)\n        {\n            return (type == JsonContainerType.Array || type == JsonContainerType.Constructor);\n        }\n\n        internal static string BuildPath(List<JsonPosition> positions, JsonPosition? currentPosition)\n        {\n            int capacity = 0;\n            if (positions != null)\n            {\n                for (int i = 0; i < positions.Count; i++)\n                {\n                    capacity += positions[i].CalculateLength();\n                }\n            }\n            if (currentPosition != null)\n            {\n                capacity += currentPosition.GetValueOrDefault().CalculateLength();\n            }\n\n            StringBuilder sb = new StringBuilder(capacity);\n            if (positions != null)\n            {\n                foreach (JsonPosition state in positions)\n                {\n                    state.WriteTo(sb);\n                }\n            }\n            if (currentPosition != null)\n            {\n                currentPosition.GetValueOrDefault().WriteTo(sb);\n            }\n\n            return sb.ToString();\n        }\n\n        internal static string FormatMessage(IJsonLineInfo lineInfo, string path, string message)\n        {\n            \/\/ don't add a fullstop and space when message ends with a new line\n            if (!message.EndsWith(Environment.NewLine, StringComparison.Ordinal))\n            {\n                message = message.Trim();\n\n                if (!message.EndsWith('.'))\n                {\n                    message += \".\";\n                }\n\n                message += \" \";\n            }\n\n            message += \"Path '{0}'\".FormatWith(CultureInfo.InvariantCulture, path);\n\n            if (lineInfo != null && lineInfo.HasLineInfo())\n            {\n                message += \", line {0}, position {1}\".FormatWith(CultureInfo.InvariantCulture, lineInfo.LineNumber, lineInfo.LinePosition);\n            }\n\n            message += \".\";\n\n            return message;\n        }\n    }\n}\n","subs":[{"cs.string":{"pos":1540,"text":"'.'"}},{"cs.string":{"pos":1545,"text":"' '"}},{"cs.string":{"pos":1550,"text":"'['"}},{"cs.string":{"pos":1555,"text":"']'"}},{"cs.string":{"pos":1560,"text":"'('"}},{"cs.string":{"pos":1565,"text":"')'"}},{"cs.string":{"pos":2355,"text":"\"Type\""}},{"cs.string":{"pos":2721,"text":"\"['\""}},{"cs.string":{"pos":2812,"text":"\"']\""}},{"cs.string":{"pos":2995,"text":"'.'"}},{"cs.string":{"pos":3254,"text":"'['"}},{"cs.string":{"pos":3331,"text":"']'"}},{"cs.string":{"pos":4888,"text":"'.'"}},{"cs.string":{"pos":4943,"text":"\".\""}},{"cs.string":{"pos":4994,"text":"\" \""}},{"cs.string":{"pos":5037,"text":"\"Path '{0}'\""}},{"cs.string":{"pos":5200,"text":"\", line {0}, position {1}\""}},{"cs.string":{"pos":5351,"text":"\".\""}}]}}
