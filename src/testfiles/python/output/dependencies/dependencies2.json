{"py.dependencies":{"text":"#import sys, rsa_key_generator as rkg, os\n\nDEFAULT_BLOCK_SIZE = 128\nBYTE_SIZE = 256\n\ndef main():\n    filename = 'encrypted_file.txt'\n    response = input('Encrypte\\Decrypt [e\\d]: ')\n\n    if response.lower().startswith('e'):\n        mode = 'encrypt'\n    elif response.lower().startswith('d'):\n        mode = 'decrypt'\n\n    if mode == 'encrypt':\n        if not os.path.exists('rsa_pubkey.txt'):\n            rkg.makeKeyFiles('rsa', 1024)\n            \n        message = input('\\nEnter message: ')\n        pubKeyFilename = 'rsa_pubkey.txt'\n        print('Encrypting and writing to %s...' % (filename))\n        encryptedText = encryptAndWriteToFile(filename, pubKeyFilename, message)\n\n        print('\\nEncrypted text:')\n        print(encryptedText)\n\n    elif mode == 'decrypt':\n        privKeyFilename = 'rsa_privkey.txt'\n        print('Reading from %s and decrypting...' % (filename))\n        decryptedText = readFromFileAndDecrypt(filename, privKeyFilename)\n        print('writing decryption to rsa_decryption.txt...')\n        with open('rsa_decryption.txt', 'w') as dec:\n            dec.write(decryptedText)\n\n        print('\\nDecryption:')\n        print(decryptedText)\n\n\ndef getBlocksFromText(message, blockSize=DEFAULT_BLOCK_SIZE):\n    messageBytes = message.encode('ascii')\n\n    blockInts = []\n    for blockStart in range(0, len(messageBytes), blockSize):\n        blockInt = 0\n        for i in range(blockStart, min(blockStart + blockSize, len(messageBytes))):\n            blockInt += messageBytes[i] * (BYTE_SIZE ** (i % blockSize))\n        blockInts.append(blockInt)\n    return blockInts\n\n\ndef getTextFromBlocks(blockInts, messageLength, blockSize=DEFAULT_BLOCK_SIZE):\n    message = []\n    for blockInt in blockInts:\n        blockMessage = []\n        for i in range(blockSize - 1, -1, -1):\n            if len(message) + i < messageLength:\n                asciiNumber = blockInt \/\/ (BYTE_SIZE ** i)\n                blockInt = blockInt % (BYTE_SIZE ** i)\n                blockMessage.insert(0, chr(asciiNumber))\n        message.extend(blockMessage)\n    return ''.join(message)\n\n\ndef encryptMessage(message, key, blockSize=DEFAULT_BLOCK_SIZE):\n    encryptedBlocks = []\n    n, e = key\n\n    for block in getBlocksFromText(message, blockSize):\n        encryptedBlocks.append(pow(block, e, n))\n    return encryptedBlocks\n\n\ndef decryptMessage(encryptedBlocks, messageLength, key, blockSize=DEFAULT_BLOCK_SIZE):\n    decryptedBlocks = []\n    n, d = key\n    for block in encryptedBlocks:\n        decryptedBlocks.append(pow(block, d, n))\n    return getTextFromBlocks(decryptedBlocks, messageLength, blockSize)\n\n\ndef readKeyFile(keyFilename):\n    fo = open(keyFilename)\n    content = fo.read()\n    fo.close()\n    keySize, n, EorD = content.split(',')\n    return (int(keySize), int(n), int(EorD))\n\n\ndef encryptAndWriteToFile(messageFilename, keyFilename, message, blockSize=DEFAULT_BLOCK_SIZE):\n    keySize, n, e = readKeyFile(keyFilename)\n    if keySize < blockSize * 8:\n        sys.exit('ERROR: Block size is %s bits and key size is %s bits. The RSA cipher requires the block size to be equal to or greater than the key size. Either decrease the block size or use different keys.' % (blockSize * 8, keySize))\n\n    encryptedBlocks = encryptMessage(message, (n, e), blockSize)\n\n    for i in range(len(encryptedBlocks)):\n        encryptedBlocks[i] = str(encryptedBlocks[i])\n    encryptedContent = ','.join(encryptedBlocks)\n    encryptedContent = '%s_%s_%s' % (len(message), blockSize, encryptedContent)\n    fo = open(messageFilename, 'w')\n    fo.write(encryptedContent)\n    fo.close()\n    return encryptedContent\n\n\ndef readFromFileAndDecrypt(messageFilename, keyFilename):\n    keySize, n, d = readKeyFile(keyFilename)\n    fo = open(messageFilename)\n    content = fo.read()\n    messageLength, blockSize, encryptedMessage = content.split('_')\n    messageLength = int(messageLength)\n    blockSize = int(blockSize)\n\n    if keySize < blockSize * 8:\n        sys.exit('ERROR: Block size is %s bits and key size is %s bits. The RSA cipher requires the block size to be equal to or greater than the key size. Did you specify the correct key file and encrypted file?' % (blockSize * 8, keySize))\n\n    encryptedBlocks = []\n    for block in encryptedMessage.split(','):\n        encryptedBlocks.append(int(block))\n\n    return decryptMessage(encryptedBlocks, messageLength, (n, d), blockSize)\n\nif __name__ == '__main__':\nmain()\n","pos":1}}
